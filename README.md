## MegaD для Home Assistant
*Неофициальная версия интеграции.*  

## Описание

Интеграция MegaD-2561 позволяет управлять устройствами на базе контроллеров MegaD-2561 в системе Home Assistant. Поддерживается широкий спектр устройств и сенсоров, включая релейные выходы, ШИМ-устройства, термостаты, дисплеи и многое другое.

## Возможности

## Поддерживаемые платформы

binary_sensor - бинарные датчики (двери, движение, дым и т.д.)
sensor - различные сенсоры (температура, влажность, CO2, освещенность и т.д.)
switch - переключатели (релейные выходы)
light - освещение (релейное и ШИМ-управление)
fan - вентиляторы (релейное и ШИМ-управление)
climate - термостаты и ПИД-регуляторы
number - настройки коэффициентов ПИД-регуляторов
update - обновление прошивки контроллера
text - управление дисплеями (LCD1602, SSD1306)

## Типы портов и устройств
## Входные порты (IN)

BinaryPortIn - бинарные входы (кнопки, датчики)
BinaryPortClick - кнопки с поддержкой нажатий (одинарные, двойные, длинные)
AnalogSensor - аналоговые сенсоры
ReaderPort - считыватели (например, RFID)
Выходные порты (OUT)
ReleyPortOut - релейные выходы
PWMPortOut - ШИМ-выходы

## Сенсоры
OneWireSensorPort - датчики температуры 1-Wire
DHTSensorPort - датчики температуры и влажности DHT
I2C сенсоры:
SCD4x (CO2, температура, влажность)
STH31, HTUxxD (температура, влажность)
MBx280 (давление, температура, влажность)
INA226 (ток, напряжение)
BH1750 (освещенность)
T67xx (CO2)
BMP180 (температура, давление)
PT (давление в барах)

## Специальные устройства
I2CDisplayPort - дисплеи (LCD1602, SSD1306)
PIDControl - ПИД-регуляторы
I2C расширители (PCA9685, MCP230xx)

## Установка
Через HACS (рекомендуется)
Добавить репозиторий в HACS
Установить интеграцию "MegaD-2561"
Перезагрузить Home Assistant

## Вручную
Скопировать файлы интеграции в папку custom_components/megad/
Перезагрузить Home Assistant
Настройка

## Добавление устройства
Перейдите в Настройки → Устройства и службы → Интеграции
Нажмите "Добавить интеграцию"
Найдите "MegaD-2561"
Введите IP-адрес контроллера и пароль (по умолчанию: sec)

## Конфигурация портов
Режимы работы входных портов
P-режим - сенсор активен при замыкании контакта
R-режим - сенсор активен при размыкании контакта
P&R-режим - отображает физическое состояние контакта
C-режим - режим кнопки с поддержкой нажатий

## Типы нажатий кнопок
Одинарное нажатие - быстрое нажатие и отпускание
Двойное нажатие - два быстрых нажатия подряд
Длинное нажатие - удержание кнопки более 1 секунды
Особенности работы

## Автоматическое создание сущностей
Интеграция автоматически создает сущности на основе конфигурации портов контроллера:
OUT порты → светильники (light)
PWM порты → диммируемые светильники (light)
Порты с device_class=FAN → вентиляторы (fan)
IN порты → бинарные сенсоры (binary_sensor)
Сенсорные порты → сенсоры (sensor)

## Фильтрация данных
Для сенсоров температуры и влажности реализована фильтрация:
Отсечение неадекватных значений
Проверка на допустимые скачки значений
Автоматическая коррекция выбросов

## ПИД-регуляторы
Поддержка нагрева, охлаждения и балансного режима
Настройка коэффициентов P, I, D через сущности number
Визуализация текущего состояния регулятора

## Обновление прошивки
Автоматическая проверка обновлений
Безопасное обновление через интерфейс Home Assistant
Резервное копирование конфигурации

## Примеры использования

#### Освещение
yaml
#### Релейный свет
light:
  - platform: megad
    port: 1
    name: "Основной свет"

#### Диммируемый свет  
light:
  - platform: megad  
    port: 2
    name: "Декоративная подсветка"
Климат-контроль
yaml
#### Термостат
climate:
  - platform: megad
    port: 5
    name: "Отопление гостиной"
    device_class: "home"
Сенсоры
yaml
#### Датчик температуры
sensor:
  - platform: megad
    port: 3
    name: "Температура на улице"
    type: "temp"

#### Датчик движения
binary_sensor:
  - platform: megad  
    port: 4
    name: "Движение в коридоре"
    device_class: "motion"

## Устранение неполадок
Контроллер недоступен
Проверьте подключение к сети
Убедитесь в правильности IP-адреса
Проверьте настройки пароля
Сущности не создаются
Проверьте конфигурацию портов в веб-интерфейсе MegaD
Убедитесь, что поле "Script" = "megad"
Проверьте, что Megad-ID не пустой

## Ошибки обновления
Убедитесь в стабильности сетевого соединения
Проверьте доступность контроллера по HTTP
Проверьте права доступа к файловой системе

## Поддержка
Документация: GitHub Repository
Баг-репорты: Issue Tracker
Версия: v2025.11.1

## Требования
Home Assistant 2025.1.0 или новее
Сетевой доступ к контроллеру MegaD-2561

## Разработчик
**[Юрий](https://github.com/zmej904)**
